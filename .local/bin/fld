#!/usr/bin/env bash
flutter devices --machine | grep -q android || { echo 'Android emulator/device not running'; exit; }

PID_FILE="/tmp/flutter.pid"

kitty-tab() {
  kitty @ launch --cwd current --keep-focus --type tab --tab-title "$1" $2
}

kitty-tab gitui gitui
[ -f $PID_FILE ] && rm $PID_FILE

kitty-tab run "flutter run --pid-file $PID_FILE"
kitty-tab hotreload hot-reload-flutter

if grep -q "build_runner" pubspec.yaml; then
  kitty-tab buildrun "flutter pub run build_runner watch --delete-conflicting-outputs"
fi

kitty @ set-tab-title editor
kitty @ send-text hx lib/main.dart\\n
